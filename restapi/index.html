<!DOCTYPE html>
<html>
  <head>
    <title>FatArtifacts</title>
    <link rel="stylesheet" href="../static/semantic-2.2.11.min.css">
    <script src="../static/jquery-3.2.1"></script>
    <script src="../static/semantic-2.2.11.min.css"></script>
    <link rel="stylesheet" href="../static/style.css">
    <style>
    body {
      margin-top: 30px;
    }
    img[align=left] {
      padding-right: 1em;
    }
    img[align=right] {
      padding-left: 1em;
    }
    .ui.text::after {
      clear: both;
      content: "";
    }
    .ui.footer.segment {
      margin: 5em 0em 0em;
      padding: 5em 0em;
    }
    pre {
      padding: 0.5em 1em;
      background-color: #eee;
      overflow: auto;
    }
    #disqus_thread {
      margin-top: 7em;
    }
    blockquote {
      font-style: italic;
      color: gray;
    }
    .ui.main img {
      max-width: 100%;
    }
    
    .ui.fixed.menu, .ui.footer.segment {
      background-color: #1677de;
    }
    
    </style>

    
  </head>
  <body>

    

    <!-- header -->
    <div class="ui fixed inverted menu">
      <div class="ui container">
        <span class="header item">
          <!--<img class="logo" src="assets/images/logo.png">-->
          FatArtifacts
        </span>
        
          
      
      
      
        <a href="../" class="item ">Home</a>
      
    
        
          
      
      
      
        <a href="../layers/" class="item ">Layers</a>
      
    
        
          
      
      
      
        <a href="./" class="item active">REST-Api</a>
      
    
        
          
      
      
      
        <a href="../restcli/" class="item ">REST-Cli</a>
      
    
        

      
        <!-- GitHub -->
        <a class="item right floated" href="https://github.com/NiklasRosenstein/fatartifacts"><i class="github icon"></i>NiklasRosenstein/fatartifacts</a>
      
      </div>
    </div>

    <div class="ui grid container main">
      <div class="twelve wide column">
        <!-- content -->
        <div class="ui text container">
          
            <h1>REST-Api</h1>
          
          <p>The REST API can be embedded into existing Flask applications using the
<code>fatartifacts.web.rest.app</code> blueprint. Alternatively, you can serve the
REST API using the <code>fatartifacts.web.server.app</code> Flask application.</p>
<blockquote>
<p><strong>Important</strong>: Make sure you update the <code>fatartifacts_server_config.py</code>
before you use the built-in server.</p>
<p>The <code>HardcodedAuthorizer</code> (from the <code>fatartifacts.web.auth</code> module)
uses HTTP BasicAuth and the information passed to it's constructor.</p>
</blockquote>
<p>Get it running:</p>
<div class="codehilite"><pre><span></span>$ <span class="nv">FLASK_APP</span><span class="o">=</span>fatartifacts/web/server.py flask run
</pre></div>


<p>Example requests:</p>
<div class="codehilite"><pre><span></span>$ curl localhost:5000/
<span class="o">[</span><span class="s2">&quot;com.coolinc&quot;</span><span class="o">]</span>
$ curl localhost:5000/com.coolinc
<span class="o">[</span><span class="s2">&quot;coolsoftware&quot;</span><span class="o">]</span>
$ curl localhost:5000/com.coolinc/coolsoftware
<span class="o">[</span><span class="s2">&quot;1.0.0&quot;</span>, <span class="s2">&quot;1.1.0&quot;</span>, <span class="s2">&quot;1.1.1&quot;</span>, <span class="s2">&quot;1.1.2&quot;</span>, <span class="s2">&quot;1.2.0&quot;</span>, <span class="s2">&quot;1.3.0&quot;</span><span class="o">]</span>
$ curl localhost:5000/com.coolinc/coolsoftware/1.3.0
<span class="o">{</span>
  <span class="s2">&quot;win32-x86_64&quot;</span>: <span class="o">{</span>
    <span class="s2">&quot;filename&quot;</span>: <span class="s2">&quot;coolsoftware-1.3.0-win32-x86_64.exe&quot;</span>,
    <span class="s2">&quot;mime&quot;</span>: <span class="s2">&quot;application/octet&quot;</span>,
    <span class="s2">&quot;url&quot;</span>: <span class="s2">&quot;/read/com.coolinc/coolsoftware/1.3.0/win32-x86_64&quot;</span>
  <span class="o">}</span>,
  <span class="s2">&quot;darwin-x86_64&quot;</span>: <span class="o">{</span>
    <span class="s2">&quot;filename&quot;</span>: <span class="s2">&quot;coolsoftware-1.3.0-darwin-x86_64.dmg&quot;</span>,
    <span class="s2">&quot;mime&quot;</span>: <span class="s2">&quot;application/octet&quot;</span>,
    <span class="s2">&quot;url&quot;</span>: <span class="s2">&quot;/read/com.coolinc/coolsoftware/1.3.0/darwin-x86_64&quot;</span>
  <span class="o">}</span>
<span class="o">}</span>
$ curl -X PUT http://com.coolinc:PleaseDontStealMySecrets@localhost:5000/com.coolinc/coolsoftware/1.3.0/linux-x86_64 <span class="se">\</span>
  -H <span class="s1">&#39;Content-Type: application/octet&#39;</span> <span class="se">\</span>
  -H <span class="s1">&#39;Content-Name: coolsoftware-1.3.0-linux-x86_64.deb&#39;</span> <span class="se">\</span>
  -d @build/dist.deb
<span class="o">{</span>
  <span class="s2">&quot;message&quot;</span>: <span class="s2">&quot;Object com.coolinc:coolsoftware:1.3.0:linux-x86_64 created.&quot;</span>
<span class="o">}</span>
</pre></div>


<h2 id="configuration">Configuration</h2>
<p>The <code>fatartifacts_server_config.py</code> contains a default configuration that can
get you started. Note that unless proper migration is performed, a non-empty
artifact-repository can not simply switch storage and/or database layers.</p>
<div class="codehilite"><pre><span></span><span class="kn">from</span> <span class="nn">fatartifacts.contrib.simpleac</span> <span class="kn">import</span> <span class="n">SimpleAccessControl</span>
<span class="kn">from</span> <span class="nn">fatartifacts.contrib.ponydb</span> <span class="kn">import</span> <span class="n">PonyDatabase</span>
<span class="kn">from</span> <span class="nn">fatartifacts.contrib.fsstorage</span> <span class="kn">import</span> <span class="n">FsStorage</span>
<span class="kn">from</span> <span class="nn">fatartifacts.web.auth</span> <span class="kn">import</span> <span class="n">HardcodedAuthorizer</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">hashlib</span>

<span class="n">storage_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="s1">&#39;_storage&#39;</span><span class="p">)</span>

<span class="c1"># User authorization layer. Note that the username returned by the authorizer</span>
<span class="c1"># must be understood by the accesscontrol.</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">HardcodedAuthorizer</span><span class="p">({</span>
  <span class="s1">&#39;root&#39;</span><span class="p">:</span> <span class="s1">&#39;sha1:&#39;</span> <span class="o">+</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha1</span><span class="p">(</span><span class="s1">&#39;alpine&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
<span class="p">})</span>

<span class="c1"># Artifact access-control layer. Gives full permissions only to group IDs</span>
<span class="c1"># that are prefixed with the current user ID.</span>
<span class="n">accesscontrol</span> <span class="o">=</span> <span class="n">SimpleAccessControl</span><span class="p">(</span><span class="n">enforce_prefix</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">isolate</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c1"># Artifact database layer.</span>
<span class="n">database</span> <span class="o">=</span> <span class="n">PonyDatabase</span><span class="p">()</span>
<span class="n">database</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s1">&#39;sqlite&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">,</span> <span class="s1">&#39;db.sqlite&#39;</span><span class="p">),</span> <span class="n">create_db</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="c1"># Artifact storage layer.</span>
<span class="n">storage</span> <span class="o">=</span> <span class="n">FsStorage</span><span class="p">(</span><span class="n">storage_dir</span><span class="p">)</span>

<span class="c1"># Azure storage example:</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">from fatartifacts.contrib.azureblobstorage import AzureBlobStorage</span>
<span class="sd">from azure.storage.blob import BlockBlobService</span>
<span class="sd">storage = AzureBlobStorage(</span>
<span class="sd">  blob_service = BlockBlobService(</span>
<span class="sd">    account_name=&#39;MyFatArtifacts&#39;,</span>
<span class="sd">    account_key=&#39;AZUREACCOUNTAPIKEYHERE...&#39;</span>
<span class="sd">  ),</span>
<span class="sd">  container = &#39;MyContainerName&#39;</span>
<span class="sd">)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># Set this to false if the Web URLs generated by the storage backend are not</span>
<span class="c1"># accesible without authentication. The REST API will generate URLs to the</span>
<span class="c1"># /read endpoint which will pipe the content of the storage to the user using</span>
<span class="c1"># their artifact repository credentials.</span>
<span class="n">web_urls_are_public</span> <span class="o">=</span> <span class="bp">True</span>
</pre></div>


<h2 id="api-documentation">API Documentation</h2>
<h3 id="get">GET <code>/</code></h3>
<p>List all available artifact group IDs with read-access.</p>
<h3 id="get-group_id">GET <code>/&lt;group_id&gt;</code></h3>
<p>List all available artifacts in the group <em>group_id</em> with read-access.</p>
<h3 id="get-group_idartifact_id">GET <code>/&lt;group_id&gt;/&lt;artifact_id&gt;</code></h3>
<p>List all available artifact versions of the artifact <em>artifact_id</em> in the
group <em>group_id</em>. Returns 404 if you do not have read-access to the group
or artifact.</p>
<h3 id="get-group_idartifact_idversion">GET <code>/&lt;group_id&gt;/&lt;artifact_id&gt;/&lt;version&gt;</code></h3>
<p>Returns an object that maps tag-names to an ObjectWithoutTag. Returns 404
if you do not have read-access to the group or artifact.</p>
<p><em>ObjectWithoutTag</em></p>
<ul>
<li><code>filename</code>: The filename of the object.</li>
<li><code>mime</code>: The mimetype of the object.</li>
<li><code>url</code>: The download URL of the object.</li>
</ul>
<h3 id="get-group_idartifact_idversiontag">GET <code>/&lt;group_id&gt;/&lt;artifact_id&gt;/&lt;version&gt;/&lt;tag&gt;</code></h3>
<p>Returns an ObjectWithTag. Returns 404 if you do not have read-access to the
group or artifact.</p>
<p><em>ObjectWithTag extends ObjectWithoutTag</em></p>
<ul>
<li><code>tag</code>: The tag of the object.</li>
</ul>
<h3 id="put-group_idartifact_idversiontag">PUT <code>/&lt;group_id&gt;/&lt;artifact_id&gt;/&lt;version&gt;/&lt;tag&gt;</code></h3>
<p>Upload an artifact object. Returns 403 if you do not have write-access to the
group or artifact.</p>
<p><em>Headers</em></p>
<ul>
<li><code>Content-Name</code>: The filename of the uploaded object.</li>
<li><code>Content-Type</code>: The mimetype of the file.</li>
</ul>
<h3 id="delete-group_idartifact_idversiontag">DELETE <code>/&lt;group_id&gt;/&lt;artifact_id&gt;/&lt;version&gt;/&lt;tag&gt;</code></h3>
<p>Deletes an artifact object. Returns 403 if you do not have delete-access to
the group or artifact.</p>
        </div>

        <!-- disqus support -->
        
      </div>

      <!-- Table of contents -->
      <div class="four wide column">
        
        
          <h1>Table of Contents</h1>
          <div class="toc">
<ul>
<li><a href="#configuration">Configuration</a></li>
<li><a href="#api-documentation">API Documentation</a><ul>
<li><a href="#get">GET /</a></li>
<li><a href="#get-group_id">GET /&lt;group_id&gt;</a></li>
<li><a href="#get-group_idartifact_id">GET /&lt;group_id&gt;/&lt;artifact_id&gt;</a></li>
<li><a href="#get-group_idartifact_idversion">GET /&lt;group_id&gt;/&lt;artifact_id&gt;/&lt;version&gt;</a></li>
<li><a href="#get-group_idartifact_idversiontag">GET /&lt;group_id&gt;/&lt;artifact_id&gt;/&lt;version&gt;/&lt;tag&gt;</a></li>
<li><a href="#put-group_idartifact_idversiontag">PUT /&lt;group_id&gt;/&lt;artifact_id&gt;/&lt;version&gt;/&lt;tag&gt;</a></li>
<li><a href="#delete-group_idartifact_idversiontag">DELETE /&lt;group_id&gt;/&lt;artifact_id&gt;/&lt;version&gt;/&lt;tag&gt;</a></li>
</ul>
</li>
</ul>
</div>

        
      </div>
    </div>

    <!-- footer -->
    <div class="ui inverted vertical footer segment">
      <div class="ui center aligned container">
          
            <p>Copyright &copy; 2017  Niklas Rosenstein</p>
          
          <p>
             &mdash; 
            Generated with <a href="https://github.com/NiklasRosenstein/yassg">Yassg</a>
          </p>
      </div>
    </div>
  </body>
</html>